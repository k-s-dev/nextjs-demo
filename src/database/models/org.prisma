model TasksUser {
  id         User        @relation(fields: [userId], references: [id])
  userId     String      @unique
  tags       Tag[]
  workspaces Workspace[]
  tasks      Task[]

  @@map("tasks_user")
}

model Tag {
  id          String    @id @default(cuid())
  name        String    @db.Citext
  // info
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  // relations
  createdBy   TasksUser @relation(fields: [createdById], references: [userId])
  createdById String
  tasks       Task[]

  @@unique([createdById, name])
  @@map("tag")
}

model Workspace {
  id          String     @id @default(cuid())
  name        String     @unique @db.Citext
  description String?
  // info
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now()) @updatedAt
  // relations
  createdBy   TasksUser  @relation(fields: [createdById], references: [userId])
  createdById String
  categories  Category[]
  priorities  Priority[]
  statuses    Status[]

  @@unique([name, createdById])
  @@map("workspace")
}

model Category {
  id          String     @id @default(cuid())
  name        String     @db.Citext
  description String?
  order       Int?       @default(1)
  // info
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @default(now()) @updatedAt
  // relations
  parent      Category?  @relation("ParentChildren", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  parentId    String?
  children    Category[] @relation("ParentChildren")
  workspace   Workspace  @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  workspaceId String
  tasks       Task[]

  @@unique([workspaceId, parentId, name])
  @@map("category")
}

model Priority {
  id          String    @id @default(cuid())
  name        String    @db.Citext
  code        String
  order       Int
  group       Int
  // info
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @default(now()) @updatedAt
  // relations
  workspace   Workspace  @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  workspaceId String
  tasks       Task[]

  @@unique([workspaceId, name])
  @@unique([workspaceId, code])
  @@unique([workspaceId, order])
  @@map("priority")
}

model Status {
  id           String    @id @default(cuid())
  name         String    @db.Citext
  order        Int
  code         String
  group        Int
  isCompletion Boolean   @default(false)
  // info
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @default(now()) @updatedAt
  // relations
  workspace   Workspace  @relation(fields: [workspaceId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  workspaceId  String
  tasks        Task[]

  @@unique([workspaceId, name])
  @@unique([workspaceId, code])
  @@unique([workspaceId, order])
  @@map("status")
}

model Task {
  id                    String    @id @default(cuid())
  title                 String
  description           String?
  is_archived           Boolean   @default(false)
  archive_on_completion Boolean   @default(false)
  start_date            DateTime?
  end_date              DateTime?
  estimated_start       DateTime?
  estimated_end         DateTime?
  // info
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @default(now()) @updatedAt
  // relations
  createdBy             TasksUser @relation(fields: [createdById], references: [userId])
  createdById           String
  parentId              String?
  parent                Task?     @relation("ParentChildren", fields: [parentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  children              Task[]    @relation("ParentChildren")
  category              Category  @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  categoryId            String
  tags                  Tag[]
  priority              Priority? @relation(fields: [priorityId], references: [id])
  priorityId            String?
  status                Status?   @relation(fields: [statusId], references: [id])
  statusId              String?

  @@unique([categoryId, parentId, title])
  @@map("task")
}
